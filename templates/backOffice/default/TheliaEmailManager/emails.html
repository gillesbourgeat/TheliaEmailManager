{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
  {$admin_current_location = 'configuration'}
{/block}

{block name="page-title"}{intl l='Email Manager Emails' d="theliaemailmanager.bo.default"}{/block}

{block name="check-resource"}admin.email-manager.email{/block}
{block name="check-access"}view{/block}

{block name="main-content"}
  <div class="email-manager-email">

    <div id="wrapper" class="container">

      <ul class="breadcrumb">
        <li><a href="{url route_id="admin.home.view"}">{intl l="Home" d="theliaemailmanager.bo.default"}</a></li>
        <li><a href="{url route_id="admin.configuration.index"}">{intl l="Configuration" d="theliaemailmanager.bo.default"}</a></li>
        <li>{intl l="Email Manager Emails" d="theliaemailmanager.bo.default"}</li>
      </ul>

      {hook name='email-manager.email.top'}

      <div class="row">
        <div class="col-md-12 general-block-decorator">
          <div class="row">
            <div class="col-md-7 title">
              {intl l="Email Manager Emails" d="theliaemailmanager.bo.default"}
            </div>
          </div>

          <div class="col-md-12">
            <table class="display js-table-list" cellspacing="0" width="100%">
              <thead>
              <tr>
                <th>{intl l="Name" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Email" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Action" d="theliaemailmanager.bo.default"}</th>
              </tr>
              </thead>
              <tfoot>
              <tr>
                <th>{intl l="Name" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Email" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Action" d="theliaemailmanager.bo.default"}</th>
              </tr>
              </tfoot>
              <tbody>
              </tbody>
            </table>
          </div>

        </div>
      </div>

      {hook name='email-manager.email.bottom'}
    </div>
  </div>
{/block}

{block name="javascript-initialization"}
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
  <script>
    "use strict";
    (function($, $tableAjax){

      var ROUTE = {
        LIST_AJAX: "{url router="theliaemailmanager" route_id="admin_email_manager_email"}",
        JQUERY_DATATABLE_LANG: "//cdn.datatables.net/plug-ins/1.10.11/i18n/%lang%.json"
      };

      var LIST_LANG = {
        fr_FR: 'French',
        en_US: 'English',
        es_ES: 'Catalan',
        it_IT: 'Italian',
        ru_RU: 'Russian',
        de_DE: 'German'
      };

      // function lang for jQuery DataTable
      function getI18nUrl(locale) {
        return ROUTE.JQUERY_DATATABLE_LANG.replace(
                '%lang%',
                (typeof LIST_LANG[locale] !== "undefined") ? LIST_LANG[locale] : 'English'
        );
      }

      var tableAjax = $tableAjax.dataTable({
        language: {
          url: getI18nUrl("{lang attr='locale'}")
        },
        processing: true,
        serverSide: true,
        ajax : ROUTE.LIST_AJAX,
        initComplete: function(settings, json) {
          var timer = null, lastValue = null, datatable = this;
          $(this[0])
            .parents('.dataTables_wrapper')
            .find('.dataTables_filter input')
            .off()
            .on('keypress keyup', function (e) {
              clearTimeout(timer);
              timer = setTimeout(function (item) {
                if (item.value.length === 0 || (item.value.length > 3 && item.value !== lastValue)) {
                  lastValue = item.value;
                  datatable.fnFilter(lastValue);
                }
              }, 400, this);
            });
        }
      });

    }(jQuery, jQuery('.email-manager-email .js-table-list')));
  </script>
{/block}

{block name="after-admin-css"}
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" />
{/block}

{block name="javascript-last-call"}
  {hook name='email-manager.email.js'}
{/block}

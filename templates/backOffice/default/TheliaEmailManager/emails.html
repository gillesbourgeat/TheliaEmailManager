{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
  {$admin_current_location = 'configuration'}
{/block}

{block name="page-title"}{intl l='Email Manager Emails' d="theliaemailmanager.bo.default"}{/block}

{block name="check-resource"}admin.email-manager.email{/block}
{block name="check-access"}view{/block}

{block name="main-content"}
  <div class="email-manager-email">

    <div id="wrapper" class="container">

      <ul class="breadcrumb">
        <li><a href="{url route_id="admin.home.view"}">{intl l="Home" d="theliaemailmanager.bo.default"}</a></li>
        <li><a href="{url route_id="admin.configuration.index"}">{intl l="Configuration" d="theliaemailmanager.bo.default"}</a></li>
        <li>{intl l="Email Manager Emails" d="theliaemailmanager.bo.default"}</li>
      </ul>

      {hook name='email-manager.email.top'}

      <div class="row">
        <div class="col-md-12 general-block-decorator">
          <div class="row">
            <div class="col-md-7 title">
              {intl l="Email Manager Emails" d="theliaemailmanager.bo.default"}
            </div>
          </div>

          <div class="col-md-12">
            <table class="display js-table-list" cellspacing="0" width="100%">
              <thead>
              <tr>
                <th>{intl l="ID" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Name" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Email" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Disabling date" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Action" d="theliaemailmanager.bo.default"}</th>
              </tr>
              </thead>
              <tfoot>
              <tr>
                <th>{intl l="ID" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Name" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Email" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Disabling date" d="theliaemailmanager.bo.default"}</th>
                <th>{intl l="Action" d="theliaemailmanager.bo.default"}</th>
              </tr>
              </tfoot>
              <tbody>
              </tbody>
            </table>
          </div>

        </div>
      </div>

      {hook name='email-manager.email.bottom'}
    </div>
  </div>
{/block}

{block name="javascript-initialization"}
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
  <script>
    "use strict";
    (function($, $tableAjax){

      var ROUTE = {
        LIST_AJAX: "{url router="theliaemailmanager" route_id="admin_email_manager_email"}",
        JQUERY_DATATABLE_LANG: "//cdn.datatables.net/plug-ins/1.10.11/i18n/%lang%.json"
      };

      var LIST_LANG = {
        fr_FR: 'French',
        en_US: 'English',
        es_ES: 'Catalan',
        it_IT: 'Italian',
        ru_RU: 'Russian',
        de_DE: 'German'
      };

      // AJAX directory
      var AJAX_DIRECTORY = {
        ID: 0,
        NAME: 1,
        EMAIL: 2,
        DATE: 3
      };

      // Table directory
      var TABLE_DIRECTORY = {
        ID: 0,
        NAME: 1,
        EMAIL: 2,
        DATE: 3,
        ACTION: 4
      };

      // function lang for jQuery DataTable
      function getI18nUrl(locale) {
        return ROUTE.JQUERY_DATATABLE_LANG.replace(
                '%lang%',
                (typeof LIST_LANG[locale] !== "undefined") ? LIST_LANG[locale] : 'English'
        );
      }

      var tableAjax = $tableAjax.dataTable({
        language: {
          url: getI18nUrl("{lang attr='locale'}")
        },
        processing: true,
        serverSide: true,
        ajax : ROUTE.LIST_AJAX,
        columnDefs: [
          {
            visible: false,
            targets: TABLE_DIRECTORY.ID
          },
          {
            "render": function(data, type, row) {
              return row[AJAX_DIRECTORY.DATE];
            },
            targets: TABLE_DIRECTORY.DATE
          },
          {
            "render": function(data, type, row) {
              return '<button ' + ((!row[AJAX_DIRECTORY.DATE]) ? 'disabled' : '') + ' data-id="' + row[AJAX_DIRECTORY.ID] + '" class="btn btn-primary js-action-delete" href="#sublime_message_history_delete_dialog" data-toggle="modal">{intl l="Reactivate" d="theliaemailmanager.bo.default"}</button>'
                  + '<button data-id="' + row[AJAX_DIRECTORY.ID] + '" class="btn btn-info js-action-view" href="#sublime_message_history_view_dialog" data-toggle="modal">{intl l="Edit" d="theliaemailmanager.bo.default"}</button>';
            },
            sortable: false,
            targets: TABLE_DIRECTORY.ACTION
          }
        ],
        initComplete: function(settings, json) {
          var timer = null, lastValue = null, datatable = this;
          $(this[0])
            .parents('.dataTables_wrapper')
            .find('.dataTables_filter input')
            .off()
            .on('keypress keyup', function (e) {
              clearTimeout(timer);
              timer = setTimeout(function (item) {
                if (item.value.length === 0 || (item.value.length > 3 && item.value !== lastValue)) {
                  lastValue = item.value;
                  datatable.fnFilter(lastValue);
                }
              }, 400, this);
            });
        }
      });

    }(jQuery, jQuery('.email-manager-email .js-table-list')));
  </script>
{/block}

{block name="after-admin-css"}
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css" />
  <style>
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      padding: 0;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      border: none;
    }
  </style>
{/block}

{block name="javascript-last-call"}
  {hook name='email-manager.email.js'}
{/block}

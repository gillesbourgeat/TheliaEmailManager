{if $history}
    <div class="row">

        {$types = ['from', 'to', 'cc', 'bcc', 'rt']}

        {foreach from=$types item=emailType}
            <div class="col-md-12">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Email address %type" type=$emailType d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped js-table-{$emailType}">
                            <thead>
                            <tr>
                                <th>
                                    {intl l="Email :" d="theliaemailmanager.bo.default"}
                                </th>
                                <th>
                                    {intl l="Name :" d="theliaemailmanager.bo.default"}
                                </th>
                                <th>
                                    {intl l="Remove" d="theliaemailmanager.bo.default"}
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {foreach from=$historyEmails[$emailType] item=value}
                                <tr>
                                    <td>
                                        <div class="form-group">
                                            <input type="email" value="{$value['email']}" class="form-control"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            <input type="text" value="{$value['name']}" class="form-control"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            <button type="button" class="btn btn-danger js-action-remove-{$emailType}">{intl l="Remove" d="theliaemailmanager.bo.default"}</button>
                                        </div>
                                    </td>
                                </tr>
                            {/foreach}
                            {if !count($historyEmails[$emailType])}
                                <tr>
                                    <td colspan="3" class="text-center">
                                        {intl l="No email address %type" type=$emailType d="theliaemailmanager.bo.default"}
                                    </td>
                                </tr>
                            {/if}
                            </tbody>
                            <tfoot>
                            <tr>
                                <td colspan="3" class="text-center">
                                    <button class="btn btn-success js-action-add-{$emailType}">{intl l="Add email address %type" type=$emailType d="theliaemailmanager.bo.default"}</button>
                                </td>
                            </tr>
                            </tfoot>
                        </table>

                    </div>
                </div>
            </div>
        {/foreach}

        {if $history->getStatus() == 3}
        <div class="col-md-12">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    <h3 class="panel-title">{intl l="Error while sending" d="theliaemailmanager.bo.default"}</h3>
                </div>
                <div class="panel-body">{$history->getInfo()}</div>
            </div>
        </div>
        {/if}

        {if $history->getStatus() == 2}
            <div class="col-md-12">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Blocked while sending" d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">{$history->getInfo()}</div>
                </div>
            </div>
        {/if}

        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">{intl l="Subject" d="theliaemailmanager.bo.default"}</h3>
                </div>
                <div class="panel-body">{$history->getSubject()}</div>
            </div>

            {if $historyEmails['rc']}
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Replay to" d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">
                        {foreach from=$historyEmails['rc'] item=value}
                            <div>{$value['email']} : {$value['name']}</div>
                        {/foreach}
                    </div>
                </div>
            {/if}
        </div>

        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">{intl l="From" d="theliaemailmanager.bo.default"}</h3>
                </div>
                <div class="panel-body">
                    {foreach from=$historyEmails['from'] item=value}
                        <div>{$value['email']} : {$value['name']}</div>
                    {/foreach}
                </div>
            </div>

            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">{intl l="To" d="theliaemailmanager.bo.default"}</h3>
                </div>
                <div class="panel-body">
                    {foreach from=$historyEmails['to'] item=value}
                        <div>{$value['email']} : {$value['name']}</div>
                    {/foreach}
                </div>
            </div>
        </div>

        {if $historyEmails['cc']}
            <div class="col-md-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Cc" d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">
                        {foreach from=$historyEmails['cc'] item=value}
                            <div>{$value['email']} : {$value['name']}</div>
                        {/foreach}
                    </div>
                </div>
            </div>
        {/if}

        {if $historyEmails['bcc']}
            <div class="col-md-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Bcc" d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">
                        {foreach from=$historyEmails['bcc'] item=value}
                            <div>{$value['email']} : {$value['name']}</div>
                        {/foreach}
                    </div>
                </div>
            </div>
        {/if}

        {if $historyEmails['rt']}
            <div class="col-md-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">{intl l="Reply-To" d="theliaemailmanager.bo.default"}</h3>
                    </div>
                    <div class="panel-body">
                        {foreach from=$historyEmails['rt'] item=value}
                            <div>{$value['email']} : {$value['name']}</div>
                        {/foreach}
                    </div>
                </div>
            </div>
        {/if}

        <div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <button style="margin-top: -7px;" class="btn btn-info pull-right btn-sm js-source-code">{intl l="Source code" d="theliaemailmanager.bo.default"}</button>
                    <h3 class="panel-title">{intl l="History body" d="theliaemailmanager.bo.default"}</h3>
                </div>
                <iframe frameborder="0" width="100%" height="500"></iframe>
                <pre class="hidden"><code></code></pre>
            </div>
        </div>

        <script type="text/html" class="tpl-message-body">
            {$historyBody|nl2br nofilter}
        </script>
    </div>

{else}
    <div class="alert alert-danger">
        {intl l="Unable to load this history." d="theliaemailmanager.bo.default"}
    </div>
{/if}